version: '3.9'

networks:
  vault_net:

configs:
  #the vault-config configuration should be created before this stack
  #is deployed.  you can run `docker config create vault-config config.hcl`
  #from this directory to create the config with the proper value
  vault-config:
    external: true

services:
  vault:
    image: hashicorp/vault:1.14
    command:
      - "server"    
    cap_add:
      - IPC_LOCK
    networks:
      vault_net:
        aliases:
          - vault.home.arpa
    environment:
      - VAULT_ADDR=http://vault.home.arpa:8200
      - VAULT_API_ADDR=http://vault.home.arpa:8200
      - VAULT_CLUSTER_ADDR=http://vault.home.arpa:8201
      - VAULT_DISABLE_MLOCK=true
      - VAULT_UI=true
    volumes:
      - /mnt/vault:/vault/data
    configs:
      - source: vault-config
        target: /vault/config/config.hcl